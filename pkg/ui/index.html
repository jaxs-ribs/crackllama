<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crackllama</title>
</head>
<body>
    <div>
        <textarea id="promptInput" placeholder="Enter your prompt" onkeypress="handleKeyPress(event)" rows="1"></textarea>
    </div>
    <div id="answerDisplay"></div>

    <style>
        body {
            background-color: #1e1e1e; /* Dark grey background */
            color: rgb(239, 239, 239); /* White text color */
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; /* Apple-style font with fallbacks */
            margin: 0;
            padding: 20px;
        }
        textarea {
            margin: 0; /* Reset margin */
            width: calc(100% - 20px); /* Adjust width considering padding */
            padding: 10px;
            border: none;
            border-radius: 20px;
            background-color: #444;
            color: white;
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            resize: none;
            overflow: hidden;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #555;
            color: white;
            cursor: pointer;
        }
        #answerDisplay {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
        }
        .speedRead {
            font-size: 42px; /* Larger font size */
            font-weight: bold; /* Bold font weight */
        }
        .fullText {
            font-size: 16px; /* Normal font size */
            font-weight: normal; /* Normal font weight */
            display: block; /* Block display to mimic a text box */
            white-space: pre-wrap; /* Ensures that spaces and line breaks are respected */
            background-color: #555; /* Lighter grey for the text box */
            padding: 10px;
            border-radius: 5px;
        }
        .hidden {
            display: none;
        }
        .centered {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px; /* Larger font size for speed reading */
            text-align: center;
            width: 100%; /* Ensures text alignment remains centered */
        }
    </style>
    <script>
        function submitPrompt() {
            var promptText = document.getElementById('promptInput').value;
            document.getElementById('promptInput').classList.add('hidden'); // Hide the input box
            fetch('http://localhost:8080/crackllama:crackllama:template.os/prompt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ prompt: promptText })
            })
            .then(response => response.text())
            .then(data => {
                speedRead(data);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('answerDisplay').innerText = 'Error fetching response';
                document.getElementById('promptInput').classList.remove('hidden'); // Show the input box on error
            });
        }
    
        function speedRead(text) {
            const words = text.split(' ');
            const msPerWord = 60000 / 600; // 600 words per minute
            let index = 0;
            const display = document.getElementById('answerDisplay');
            display.innerHTML = ''; // Clear previous text
            display.classList.add('centered'); // Center the text
    
            const interval = setInterval(() => {
                if (index < words.length) {
                    display.innerHTML = `<span class="speedRead">${words[index]}</span>`;
                    index++;
                } else {
                    finishSpeedRead();
                }
            }, msPerWord);
    
            function finishSpeedRead() {
                clearInterval(interval);
                display.innerHTML = `<span class="fullText">${text}</span>`; // Display full text at the end
                display.classList.remove('centered'); // Remove centering
                document.getElementById('promptInput').classList.remove('hidden'); // Show the input box
            }
    
            document.addEventListener('keydown', function skipSpeedRead(event) {
                if (event.key === "Enter" || event.key === "Escape" || event.key === " ") {
                    finishSpeedRead();
                    document.removeEventListener('keydown', skipSpeedRead); // Remove the event listener to prevent memory leaks
                }
            });
        }

        function handleKeyPress(event) {
            if (event.key === "Enter" && !event.shiftKey) {
                event.preventDefault(); // Prevent form submission on Enter
                submitPrompt();
            } else if (event.key === "Enter" && event.shiftKey) {
                // Allow Shift+Enter to insert a new line
                let textarea = document.getElementById('promptInput');
                let cursorPos = textarea.selectionStart;
                let textBefore = textarea.value.substring(0, cursorPos);
                let textAfter  = textarea.value.substring(cursorPos, textarea.value.length);
                textarea.value = textBefore + "\n" + textAfter;
                // Move the cursor to the right position after inserting the newline
                textarea.selectionStart = cursorPos + 1;
                textarea.selectionEnd = cursorPos + 1;
            }
        }

        function autoExpand(field) {
            // Reset field height
            field.style.height = 'inherit';

            // Get the computed styles for the element
            var computed = window.getComputedStyle(field);

            // Calculate the height
            var height = parseInt(computed.getPropertyValue('border-top-width'), 10)
                        + parseInt(computed.getPropertyValue('padding-top'), 10)
                        + field.scrollHeight
                        + parseInt(computed.getPropertyValue('padding-bottom'), 10)
                        + parseInt(computed.getPropertyValue('border-bottom-width'), 10);

            field.style.height = height + 'px';
        }

        document.getElementById('promptInput').addEventListener('input', function() {
            autoExpand(this);
        });
    </script>

    
</body>
</html>